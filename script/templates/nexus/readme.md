# Using Nuget Server in VS 2017

## Setup Nuget CLI
Download the file _nuget.exe_ from the official website:
> https://dist.nuget.org/win-x86-commandline/latest/nuget.exe

copy the file in a folder included in the PATH environment variable

## Creating the .nuspec file
A NuGet package contains a manifest (a .nuspec file), that contains relevant metadata such as the package identifier, version number, description, and more. Some of these can be drawn from the project properties directly, which avoids having to separately update them in both the project and the manifest.

On the Project Folder and from a command line execute the command 
> nuget spec

to create a new manifest file with the initial information taken from the project.

## Edit the manifest
NuGet produces an error if you try to create a package with default values in your .nuspec file, so you must edit the following fields before proceeding.

## Installing nuget package to extend MSBuild targets
To automagically pack your nuget package and deploy to your personal Nuget server, install this nuget package

> https://guibranco.github.io/MSBuild.PublishNuget.Target/
> Install-Package MSBuild.PublishNuget.Target

To complete the configuration, follow these steps:
- adding these lines to you .csproj file and supply the correct PackageAPIKey and PackageServer information

```
<PropertyGroup>
  <PackageDir>c:\temp\packagedir</PackageDir>
  <PackageAPIKey>b0f2f432b4fac02bbc6a68559db4a99c226e413fd0141a57c68123878a4c4314</PackageAPIKey>
  <PackageServer>http://localhost:9011/api/v2/package</PackageServer>
</PropertyGroup>
```

The PackageServer should be modified according to the configuration released by CLA mantainer.

The PackageAPIKey is generated by the installed Repository service

## Nexus OSS Binary Repository
The repository service chosen to store nuget packages is Nexus OSS, we have decided to use the docker container released by the official website

> 

The steps required to properly configure Nexus are hereunder listed:
- for docker, a new volume should be created to persists private repositories
- create new user with correct roles (e.g. Developer with )
    + nx-apikey-all
    + nx-repository-view-*-*-*
    + nx-search-read
- a new Api Key should be generated

### Nuget configuration
The configurations required to push packages are:

- Add your Nuget Nexus repository url to your Nuget.config executing this command in a CLI
```
nuget sources add -Name "CLANexus" -Source "http://localhost:8081/repository/nuget-hosted/" -username "%your-username%" -password "%your-password%"
```

- Add your Nexus API KEY with this command
```
nuget setapikey %your-api-key% -source http://localhost:8081/repository/nuget-hosted/
```

Hereunder the configuration required to push packages from Visual Studio:
- after having installed the MSBuild.PublishNuget.Target, add a PropertyGroup to your project file and configure it
```
<PropertyGroup>
  <PackageDir>c:\temp\packagedir</PackageDir>
  <PackageAPIKey>b0f2f432b4fac02bbc6a68559db4a99c226e413fd0141a57c68123878a4c4314</PackageAPIKey>
  <PackageServer>http://localhost:9011/api/v2/package</PackageServer>
</PropertyGroup>
```

Hereunder the configuration required to restore Nuget packages in Visual Studio:
- Start Visual Studio, then select Tools > Options...
- Expand NuGet Package Manager, then select Package Sources.
- Click the plus button in the upper right corner of the Options dialog box.
- At the bottom of the Options dialog box, enter the following:
> Set the Name to Nexus OSS
> Set the Source to http://localhost:8081/service/local/nuget/feed/

-Click the Update to save the package source.

## Docker volumes
The WSL2 folder where volume are located here
```
\\wsl$\docker-desktop-data\version-pack-data\community\docker\volumes
```

usually instead of mounting a folder it might be best solution to create a volume.


## My Local configuration

> admin password: DelfinoCurioso2020
> giuseppe.grilli password: DelfinoCurioso

Register for Nuget config
> nuget setapikey 4621b990-9349-3a24-8d8a-61cee3404e5b -source http://localhost:8081/repository/nuget-hosted/

Seting user and password
> nuget sources add -Name "CLANexus" -Source "http://localhost:8081/repository/nuget-hosted/" -username "giuseppe.grilli" -password "DelfinoCurioso2020"

## CLA Nexus configuration

> admin password: password
> giuseppe.grilli password: password

Register for Nuget config
> nuget setapikey 883eb132-10a8-3b98-9235-2c87d4437ee0 -source http://docker-01:8081/repository/nuget-hosted/

Seting user and password
> nuget sources add -Name "CLADockerNexus" -Source "http://docker-01:8081/repository/nuget-hosted/" -username "giuseppe.grilli" -password "password"

## Example of Push command
> nuget.exe push -source CLADockerNexus mypackage.1.0.0.nupkg

## Creating stand-alone nuget packages
Download and install Nuget Package Explorer

> https://github.com/NuGetPackageExplorer/NuGetPackageExplorer
